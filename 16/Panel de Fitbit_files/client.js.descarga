"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function indexOf(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function callbacksFor(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t}function configure(e,t){return 2!==arguments.length?config[e]:void(config[e]=t)}function objectOrFunction(e){var t="undefined"==typeof e?"undefined":_typeof(e);return null!==e&&("object"===t||"function"===t)}function isFunction(e){return"function"==typeof e}function isObject(e){return null!==e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))}function isMaybeThenable(e){return null!==e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))}function scheduleFlush(){setTimeout(function(){for(var e=0;e<queue.length;e++){var t=queue[e],n=t.payload;n.guid=n.key+n.id,n.childGuid=n.key+n.childId,n.error&&(n.stack=n.error.stack),config.trigger(t.name,t.payload)}queue.length=0},50)}function instrument(e,t,n){1===queue.push({name:e,payload:{key:t._guidKey,id:t._id,eventName:e,detail:t._result,childId:n&&n._id,label:t._label,timeStamp:now(),error:config["instrument-with-stack"]?new Error(t._label):null}})&&scheduleFlush()}function resolve$1(e,t){var n=this;if(e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))&&e.constructor===n)return e;var r=new n(noop,t);return resolve(r,e),r}function withOwnPromise(){return new TypeError("A promises callback cannot return that same promise.")}function noop(){}function getThen(e){try{return e.then}catch(t){return GET_THEN_ERROR.error=t,GET_THEN_ERROR}}function tryThen(e,t,n,r){try{e.call(t,n,r)}catch(o){return o}}function handleForeignThenable(e,t,n){config.async(function(e){var r=!1,o=tryThen(n,t,function(n){r||(r=!0,t!==n?resolve(e,n,void 0):fulfill(e,n))},function(t){r||(r=!0,reject(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&o&&(r=!0,reject(e,o))},e)}function handleOwnThenable(e,t){t._state===FULFILLED?fulfill(e,t._result):t._state===REJECTED?(t._onError=null,reject(e,t._result)):subscribe(t,void 0,function(n){t!==n?resolve(e,n,void 0):fulfill(e,n)},function(t){return reject(e,t)})}function handleMaybeThenable(e,t,n){var r=t.constructor===e.constructor&&n===then&&e.constructor.resolve===resolve$1;r?handleOwnThenable(e,t):n===GET_THEN_ERROR?(reject(e,GET_THEN_ERROR.error),GET_THEN_ERROR.error=null):isFunction(n)?handleForeignThenable(e,t,n):fulfill(e,t)}function resolve(e,t){e===t?fulfill(e,t):objectOrFunction(t)?handleMaybeThenable(e,t,getThen(t)):fulfill(e,t)}function publishRejection(e){e._onError&&e._onError(e._result),publish(e)}function fulfill(e,t){e._state===PENDING&&(e._result=t,e._state=FULFILLED,0===e._subscribers.length?config.instrument&&instrument("fulfilled",e):config.async(publish,e))}function reject(e,t){e._state===PENDING&&(e._state=REJECTED,e._result=t,config.async(publishRejection,e))}function subscribe(e,t,n,r){var o=e._subscribers,i=o.length;e._onError=null,o[i]=t,o[i+FULFILLED]=n,o[i+REJECTED]=r,0===i&&e._state&&config.async(publish,e)}function publish(e){var t=e._subscribers,n=e._state;if(config.instrument&&instrument(n===FULFILLED?"fulfilled":"rejected",e),0!==t.length){for(var r=void 0,o=void 0,i=e._result,s=0;s<t.length;s+=3)r=t[s],o=t[s+n],r?invokeCallback(n,r,o,i):o(i);e._subscribers.length=0}}function ErrorObject(){this.error=null}function tryCatch(e,t){try{return e(t)}catch(n){return TRY_CATCH_ERROR.error=n,TRY_CATCH_ERROR}}function invokeCallback(e,t,n,r){var o=isFunction(n),i=void 0,s=void 0;if(o){if(i=tryCatch(n,r),i===TRY_CATCH_ERROR)s=i.error,i.error=null;else if(i===t)return void reject(t,withOwnPromise())}else i=r;t._state!==PENDING||(o&&void 0===s?resolve(t,i):void 0!==s?reject(t,s):e===FULFILLED?fulfill(t,i):e===REJECTED&&reject(t,i))}function initializePromise(e,t){var n=!1;try{t(function(t){n||(n=!0,resolve(e,t))},function(t){n||(n=!0,reject(e,t))})}catch(r){reject(e,r)}}function then(e,t,n){var r=this,o=r._state;if(o===FULFILLED&&!e||o===REJECTED&&!t)return config.instrument&&instrument("chained",r,r),r;r._onError=null;var i=new r.constructor(noop,n),s=r._result;if(config.instrument&&instrument("chained",r,i),o===PENDING)subscribe(r,i,e,t);else{var a=o===FULFILLED?e:t;config.async(function(){return invokeCallback(o,i,a,s)})}return i}function makeSettledResult(e,t,n){return e===FULFILLED?{state:"fulfilled",value:n}:{state:"rejected",reason:n}}function all(e,t){return isArray(e)?new Enumerator(this,e,(!0),t).promise:this.reject(new TypeError("Promise.all must be called with an array"),t)}function race(e,t){var n=this,r=new n(noop,t);if(!isArray(e))return reject(r,new TypeError("Promise.race must be called with an array")),r;for(var o=0;r._state===PENDING&&o<e.length;o++)subscribe(n.resolve(e[o]),void 0,function(e){return resolve(r,e)},function(e){return reject(r,e)});return r}function reject$1(e,t){var n=this,r=new n(noop,t);return reject(r,e),r}function needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function Result(){this.value=void 0}function getThen$1(e){try{return e.then}catch(t){return ERROR.value=t,ERROR}}function tryApply(e,t,n){try{e.apply(t,n)}catch(r){return ERROR.value=r,ERROR}}function makeObject(e,t){for(var n={},r=e.length,o=new Array(r),i=0;i<r;i++)o[i]=e[i];for(var s=0;s<t.length;s++){var a=t[s];n[a]=o[s+1]}return n}function arrayResult(e){for(var t=e.length,n=new Array(t-1),r=1;r<t;r++)n[r-1]=e[r];return n}function wrapThenable(e,t){return{then:function(n,r){return e.call(t,n,r)}}}function denodeify(e,t){var n=function(){for(var n=this,r=arguments.length,o=new Array(r+1),i=!1,s=0;s<r;++s){var a=arguments[s];if(!i){if(i=needsPromiseInput(a),i===GET_THEN_ERROR$1){var u=new Promise(noop);return reject(u,GET_THEN_ERROR$1.value),u}i&&i!==!0&&(a=wrapThenable(i,a))}o[s]=a}var l=new Promise(noop);return o[r]=function(e,n){e?reject(l,e):void 0===t?resolve(l,n):t===!0?resolve(l,arrayResult(arguments)):isArray(t)?resolve(l,makeObject(arguments,t)):resolve(l,n)},i?handlePromiseInput(l,o,e,n):handleValueInput(l,o,e,n)};return n.__proto__=e,n}function handleValueInput(e,t,n,r){var o=tryApply(n,r,t);return o===ERROR&&reject(e,o.value),e}function handlePromiseInput(e,t,n,r){return Promise.all(t).then(function(t){var o=tryApply(n,r,t);return o===ERROR&&reject(e,o.value),e})}function needsPromiseInput(e){return!(!e||"object"!==("undefined"==typeof e?"undefined":_typeof(e)))&&(e.constructor===Promise||getThen$1(e))}function all$1(e,t){return Promise.all(e,t)}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function allSettled(e,t){return isArray(e)?new AllSettled(Promise,e,t).promise:Promise.reject(new TypeError("Promise.allSettled must be called with an array"),t)}function race$1(e,t){return Promise.race(e,t)}function _possibleConstructorReturn$1(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function _inherits$1(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function hash(e,t){return isObject(e)?new PromiseHash(Promise,e,t).promise:Promise.reject(new TypeError("Promise.hash must be called with an object"),t)}function _possibleConstructorReturn$2(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function _inherits$2(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function hashSettled(e,t){return isObject(e)?new HashSettled(Promise,e,(!1),t).promise:Promise.reject(new TypeError("RSVP.hashSettled must be called with an object"),t)}function rethrow(e){throw setTimeout(function(){throw e}),e}function defer(e){var t={resolve:void 0,reject:void 0};return t.promise=new Promise(function(e,n){t.resolve=e,t.reject=n},e),t}function map(e,t,n){return isArray(e)?isFunction(t)?Promise.all(e,n).then(function(e){for(var r=e.length,o=new Array(r),i=0;i<r;i++)o[i]=t(e[i]);return Promise.all(o,n)}):Promise.reject(new TypeError("RSVP.map expects a function as a second argument"),n):Promise.reject(new TypeError("RSVP.map must be called with an array"),n)}function resolve$2(e,t){return Promise.resolve(e,t)}function reject$2(e,t){return Promise.reject(e,t)}function resolveAll(e,t){return Promise.all(e,t)}function resolveSingle(e,t){return Promise.resolve(e,t).then(function(e){return resolveAll(e,t)})}function filter(e,t,n){if(!(isArray(e)||isObject(e)&&void 0!==e.then))return Promise.reject(new TypeError("RSVP.filter must be called with an array or promise"),n);if(!isFunction(t))return Promise.reject(new TypeError("RSVP.filter expects function as a second argument"),n);var r=isArray(e)?resolveAll(e,n):resolveSingle(e,n);return r.then(function(e){for(var r=e.length,o=new Array(r),i=0;i<r;i++)o[i]=t(e[i]);return resolveAll(o,n).then(function(t){for(var n=new Array(r),o=0,i=0;i<r;i++)t[i]&&(n[o]=e[i],o++);return n.length=o,n})})}function asap(e,t){queue$1[len]=e,queue$1[len+1]=t,len+=2,2===len&&scheduleFlush$1()}function useNextTick(){var e=process.nextTick,t=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(t)&&"0"===t[1]&&"10"===t[2]&&(e=setImmediate),function(){return e(flush)}}function useVertxTimer(){return"undefined"!=typeof vertxNext?function(){vertxNext(flush)}:useSetTimeout()}function useMutationObserver(){var e=0,t=new BrowserMutationObserver(flush),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){return n.data=e=++e%2}}function useMessageChannel(){var e=new MessageChannel;return e.port1.onmessage=flush,function(){return e.port2.postMessage(0)}}function useSetTimeout(){return function(){return setTimeout(flush,1)}}function flush(){for(var e=0;e<len;e+=2){var t=queue$1[e],n=queue$1[e+1];t(n),queue$1[e]=void 0,queue$1[e+1]=void 0}len=0}function attemptVertex(){try{var e=require,t=e("vertx");return vertxNext=t.runOnLoop||t.runOnContext,useVertxTimer()}catch(n){return useSetTimeout()}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function on(){config.on.apply(config,arguments)}function off(){config.off.apply(config,arguments)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},EventTarget={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e._promiseCallbacks=void 0,e},on:function(e,t){if("function"!=typeof t)throw new TypeError("Callback must be a function");var n=callbacksFor(this),r=void 0;r=n[e],r||(r=n[e]=[]),indexOf(r,t)===-1&&r.push(t)},off:function(e,t){var n=callbacksFor(this),r=void 0,o=void 0;return t?(r=n[e],o=indexOf(r,t),void(o!==-1&&r.splice(o,1))):void(n[e]=[])},trigger:function(e,t,n){var r=callbacksFor(this),o=void 0,i=void 0;if(o=r[e])for(var s=0;s<o.length;s++)(i=o[s])(t,n)}},config={instrument:!1};EventTarget.mixin(config);var _isArray=void 0;_isArray=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var isArray=_isArray,now=Date.now||function(){return(new Date).getTime()},queue=[],PENDING=void 0,FULFILLED=1,REJECTED=2,GET_THEN_ERROR=new ErrorObject,TRY_CATCH_ERROR=new ErrorObject,Enumerator=function(){function e(e,t,n,r){this._instanceConstructor=e,this.promise=new e(noop,r),this._abortOnReject=n,this._init.apply(this,arguments)}return e.prototype._init=function(e,t){var n=t.length||0;this.length=n,this._remaining=n,this._result=new Array(n),this._enumerate(t),0===this._remaining&&fulfill(this.promise,this._result)},e.prototype._enumerate=function(e){for(var t=this.length,n=this.promise,r=0;n._state===PENDING&&r<t;r++)this._eachEntry(e[r],r)},e.prototype._settleMaybeThenable=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===resolve$1){var o=getThen(e);if(o===then&&e._state!==PENDING)e._onError=null,this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=this._makeResult(FULFILLED,t,e);else if(n===Promise){var i=new n(noop);handleMaybeThenable(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},e.prototype._eachEntry=function(e,t){isMaybeThenable(e)?this._settleMaybeThenable(e,t):(this._remaining--,this._result[t]=this._makeResult(FULFILLED,t,e))},e.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===PENDING&&(this._abortOnReject&&e===REJECTED?reject(r,n):(this._remaining--,this._result[t]=this._makeResult(e,t,n),0===this._remaining&&fulfill(r,this._result)))},e.prototype._makeResult=function(e,t,n){return n},e.prototype._willSettleAt=function(e,t){var n=this;subscribe(e,void 0,function(e){return n._settledAt(FULFILLED,t,e)},function(e){return n._settledAt(REJECTED,t,e)})},e}(),guidKey="rsvp_"+now()+"-",counter=0,Promise=function(){function e(t,n){this._id=counter++,this._label=n,this._state=void 0,this._result=void 0,this._subscribers=[],config.instrument&&instrument("created",this),noop!==t&&("function"!=typeof t&&needsResolver(),this instanceof e?initializePromise(this,t):needsNew())}return e.prototype._onError=function(e){var t=this;config.after(function(){t._onError&&config.trigger("error",e,t._label)})},e.prototype["catch"]=function(e,t){return this.then(void 0,e,t)},e.prototype["finally"]=function(e,t){var n=this,r=n.constructor;return n.then(function(t){return r.resolve(e()).then(function(){return t})},function(t){return r.resolve(e()).then(function(){throw t})},t)},e}();Promise.cast=resolve$1,Promise.all=all,Promise.race=race,Promise.resolve=resolve$1,Promise.reject=reject$1,Promise.prototype._guidKey=guidKey,Promise.prototype.then=then;var ERROR=new Result,GET_THEN_ERROR$1=new Result,AllSettled=function(e){function t(t,n,r){return _possibleConstructorReturn(this,e.call(this,t,n,!1,r))}return _inherits(t,e),t}(Enumerator);AllSettled.prototype._makeResult=makeSettledResult;var hasOwnProperty=Object.prototype.hasOwnProperty,PromiseHash=function(e){function t(t,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments[3];return _possibleConstructorReturn$1(this,e.call(this,t,n,r,o))}return _inherits$1(t,e),t.prototype._init=function(e,t){this._result={},this._enumerate(t),0===this._remaining&&fulfill(this.promise,this._result)},t.prototype._enumerate=function(e){var t=this.promise,n=[];for(var r in e)hasOwnProperty.call(e,r)&&n.push({position:r,entry:e[r]});var o=n.length;this._remaining=o;for(var i=void 0,s=0;t._state===PENDING&&s<o;s++)i=n[s],this._eachEntry(i.entry,i.position)},t}(Enumerator),HashSettled=function(e){function t(t,n,r){return _possibleConstructorReturn$2(this,e.call(this,t,n,!1,r))}return _inherits$2(t,e),t}(PromiseHash);HashSettled.prototype._makeResult=makeSettledResult;var len=0,vertxNext=void 0,browserWindow="undefined"!=typeof window?window:void 0,browserGlobal=browserWindow||{},BrowserMutationObserver=browserGlobal.MutationObserver||browserGlobal.WebKitMutationObserver,isNode="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),isWorker="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,queue$1=new Array(1e3),scheduleFlush$1=void 0;scheduleFlush$1=isNode?useNextTick():BrowserMutationObserver?useMutationObserver():isWorker?useMessageChannel():void 0===browserWindow&&"function"==typeof require?attemptVertex():useSetTimeout();var platform=void 0;if("object"===("undefined"==typeof self?"undefined":_typeof(self)))platform=self;else{if("object"!==("undefined"==typeof global?"undefined":_typeof(global)))throw new Error("no global: `self` or `global` found");platform=global}var _asap$cast$Promise$Ev;config.async=asap,config.after=function(e){return setTimeout(e,0)};var cast=resolve$2,async=function(e,t){return config.async(e,t)};if("undefined"!=typeof window&&"object"===_typeof(window.__PROMISE_INSTRUMENTATION__)){var callbacks=window.__PROMISE_INSTRUMENTATION__;configure("instrument",!0);for(var eventName in callbacks)callbacks.hasOwnProperty(eventName)&&on(eventName,callbacks[eventName])}var rsvp=(_asap$cast$Promise$Ev={asap:asap,cast:cast,Promise:Promise,EventTarget:EventTarget,all:all$1,allSettled:allSettled,race:race$1,hash:hash,hashSettled:hashSettled,rethrow:rethrow,defer:defer,denodeify:denodeify,configure:configure,on:on,off:off,resolve:resolve$2,reject:reject$2,map:map},_defineProperty(_asap$cast$Promise$Ev,"async",async),_defineProperty(_asap$cast$Promise$Ev,"filter",filter),_asap$cast$Promise$Ev);!function(){var e="https://accounts.fitbit.com",t={IFRAME_READY:"iFrameReady",AUTHENTICATE_USER:"authenticateUser",SET_LOGGED_IN_USER:"setLoggedInUser",SET_USER_ID:"setUserId",SET_SESSION_CREATION_TIME:"setSessionCreationTime",GET_LOGGED_IN_USER:"getLoggedInUser",GET_USER_ID:"getUserId",GET_SESSION_CREATION_TIME:"getSessionCreationTime",LOGOUT:"logout",TOKEN_UPDATED:"tokenUpdated",SESSION_EXPIRED:"sessionExpired",SETUP_EXTERNAL_SESSION:"setupExternalSession",ERROR_MESSAGE:"errorMessage",COOKIES_DISABLED:"cookiesDisabled",ORIGIN:"origin"},n={IFRAME_READY:{resolve:[],reject:[]},AUTHENTICATE_USER:{resolve:[],reject:[]},SET_LOGGED_IN_USER:{resolve:[],reject:[]},SET_USER_ID:{resolve:[],reject:[]},SET_SESSION_CREATION_TIME:{resolve:[],reject:[]}},r={LAZY:"lazy",EAGER:"eager"},o=void 0,i=void 0,s=s?s:null,a=!1,u=!1,l=void 0,c=void 0,f=void 0,h=void 0,d=void 0,_=void 0,p=6e3,E=function(t,n,r,a){var u={event:t,returnAccessToken:n,clientId:o,scopes:i,tokenToRevoke:r,externalSession:a};return s.contentWindow&&s.contentWindow.postMessage(u,e),u},v=function(e,r,o,i,s,a){return new Promise(function(u,l){n[e].resolve.push(o?o:u),n[e].reject.push(i?i:l),E(t[r],s,void 0,a)})},y=function(){function y(t,n){return _classCallCheck(this,y),this.init(t,n),this.setLazySession(),window.Fitbit?window.Fitbit:(this._iFrameOrigin=e,this._iFrameReady=!1,this.initIFrame(),this)}return _createClass(y,[{key:"init",value:function(e,t){e&&"string"==typeof e&&(o=e),t&&Array.isArray(t)&&t.length>0&&(i=t)}},{key:"setLazySession",value:function(){this.sessionType=r.LAZY}},{key:"isLazySession",value:function(){return this.sessionType===r.LAZY}},{key:"setClientSiteLoginError",value:function(e){h=e}},{key:"getClientSiteLoginError",value:function(){return h}},{key:"setLocale",value:function(e){e&&"string"==typeof e&&(c=e)}},{key:"getLocale",value:function(){return c}},{key:"setRecaptchaToken",value:function(e){e&&"string"==typeof e&&(f=e)}},{key:"getRecaptchaToken",value:function(){return f}},{key:"initIFrame",value:function(){var e=this;s=document.createElement("iframe"),s.setAttribute("sandbox","allow-same-origin  allow-scripts"),s.style.display="none",s.src=this._iFrameOrigin+"/clienthandler","complete"===document.readyState?document.body.appendChild(s):window.addEventListener("load",function(){document.body.appendChild(s)},!1),window.addEventListener("message",function(t){e._handleMessage(t)}),_=setTimeout(function(){if(!e._iFrameReady)try{E(t.ORIGIN,!1)}catch(n){}},p)}},{key:"fbUserLogOutCallback",value:function(){console.log("The fbUserLogOutCallback() method must be implemented.")}},{key:"fbTokenUpdatedCallback",value:function(e){console.log("The fbTokenUpdatedCallback() method must be implemented.")}},{key:"fbUserSessionExpired",value:function(){console.log("The fbUserSessionExpired() method must be implemented.")}},{key:"fbIsUserAuthenticated",value:function(e,t,n,r,o){return e?(t?this._targetAfterLogin=t:this._targetAfterLogin=window.location!==window.parent.location?document.referrer:document.location.href,y.setBackUrl(o)):this._targetAfterLogin=null,y.setWebViewMode(n),y.setUml(r),this._iFrameReady?this._getLoggedInUser():this._waitForIFrame(this._getLoggedInUser)}},{key:"fbCreateAccount",value:function(e,t,n,r,o,i){return this.fbIsUserAuthenticated(e,t,r,o,i)}},{key:"fbGetCurrentAccessToken",value:function(){return this._iFrameReady?this._getToken():this._waitForIFrame(this._getToken)}},{key:"fbGetUserId",value:function(){return this._iFrameReady?this._getUserId():this._waitForIFrame(this._getUserId)}},{key:"fbGetSessionCreationTime",value:function(){return this._iFrameReady?this._getSessionCreationTime():this._waitForIFrame(this._getSessionCreationTime)}},{key:"fbLogUserOut",value:function(e){this._iFrameReady?E("logout",!1,e):this._waitForIFrame(function(){E("logout",!1,e)})}},{key:"fbSetupExternalSession",value:function(e){var t=this;return this._iFrameReady?this._sendSetupExternalSession(e):this._waitForIFrame(function(){t._sendSetupExternalSession(e)})}},{key:"fbAuthorizationCode",value:function(t,n,r){var o=e+"/clienthandler?targetUrl="+encodeURIComponent(n)+"#code="+encodeURIComponent(t);r&&(o+="&code_verifier="+encodeURIComponent(r)),window.open(o,"_self")}},{key:"_waitForIFrame",value:function(e){return new Promise(function(t,r){n.IFRAME_READY.resolve.push(e?function(){e(t,r)}:t)})}},{key:"_getLoggedInUser",value:function(e,t){return v("AUTHENTICATE_USER","GET_LOGGED_IN_USER",e,t)}},{key:"_getToken",value:function(e,t){return v("SET_LOGGED_IN_USER","GET_LOGGED_IN_USER",e,t,!0)}},{key:"_getUserId",value:function(e,t){return v("SET_USER_ID","GET_USER_ID",e,t)}},{key:"_getSessionCreationTime",value:function(e,t){return v("SET_SESSION_CREATION_TIME","GET_SESSION_CREATION_TIME",e,t)}},{key:"_sendSetupExternalSession",value:function(e,t,n){return v("AUTHENTICATE_USER","SETUP_EXTERNAL_SESSION",t,n,!1,e)}},{key:"_handleMessage",value:function(n){var r=n.data.event,o=n.origin;if(r){if(o!==e)throw console.error("Origin not allowed."),new Error("Origin not allowed.");switch(r){case t.IFRAME_READY:_&&_.clearTimeout&&_.clearTimeout(),this._handleIframeReadyEvent();break;case t.COOKIES_DISABLED:console.warn("Cookies are disabled"),this._targetAfterLogin?(this.setClientSiteLoginError("cookies_disabled"),this._redirectToLogin()):this._rejectEventPromise("AUTHENTICATE_USER","cookies_unavailable");break;case t.AUTHENTICATE_USER:this._targetAfterLogin?this._redirectToLogin():this._resolveEventPromise("AUTHENTICATE_USER",!1);break;case t.SET_LOGGED_IN_USER:this._accessToken=n.data.accessToken,this._accessToken?this._resolveEventPromise("SET_LOGGED_IN_USER",this._accessToken):this._resolveEventPromise("AUTHENTICATE_USER",!0);break;case t.SET_USER_ID:this._resolveEventPromise("SET_USER_ID",n.data.user_id);break;case t.SET_SESSION_CREATION_TIME:this._resolveEventPromise("SET_SESSION_CREATION_TIME",n.data.creationTime);break;case t.LOGOUT:this.fbUserLogOutCallback();break;case t.TOKEN_UPDATED:this.fbTokenUpdatedCallback(n.data.accessToken);break;case t.SESSION_EXPIRED:this.fbUserSessionExpired();break;case t.ERROR_MESSAGE:this._rejectEventPromise(n.data.type,n.data.error);break;default:throw console.error("Malformed method property sent by iframe"),new Error("Malformed method property sent by iframe")}}}},{key:"_handleIframeReadyEvent",value:function(){this._iFrameReady=!0,n.IFRAME_READY.resolve.length>0&&(n.IFRAME_READY.resolve.map(function(e){e()}),n.IFRAME_READY.resolve=[])}},{key:"_resolveEventPromise",value:function(e,t){n[e].resolve.length>0&&(n[e].resolve.shift()(t),n[e].reject.shift())}},{key:"_rejectEventPromise",value:function(e,t){n[e].reject.length>0&&(n[e].reject.shift()(t),n[e].resolve.shift())}},{key:"_redirectToLogin",value:function(){var e=this._iFrameOrigin+"/login?targetUrl="+encodeURIComponent(this._targetAfterLogin);this.getLocale()&&(e+="&lcl="+encodeURIComponent(this.getLocale())),y.getBackUrl()&&(e+="&backUrl="+encodeURIComponent(y.getBackUrl())),this.getClientSiteLoginError()&&(e+="&clientSiteLoginError="+encodeURIComponent(this.getClientSiteLoginError())),y.isWebViewMode()&&(e+="&webView=true"),y.isUml()&&(e+="&uml=true"),this.getRecaptchaToken()&&(e+="&recaptchaToken="+this.getRecaptchaToken()),delete this._targetAfterLogin,window.location.replace(e)}}],[{key:"setWebViewMode",value:function(e){e&&"boolean"==typeof e&&(a=e)}},{key:"isWebViewMode",value:function(){return a}},{key:"setUml",value:function(e){e&&"boolean"==typeof e&&(u=e)}},{key:"isUml",value:function(){return u}},{key:"setBackUrl",value:function(e){e&&"string"==typeof e&&(l=e)}},{key:"getBackUrl",value:function(){return l}},{key:"setClientSiteSignupError",value:function(e){d=e}},{key:"getClientSiteSignupError",value:function(){return d}}]),y}();window.Fitbit=new y}();